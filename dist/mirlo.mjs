function e(e,t,s){document.querySelectorAll(t).forEach((t=>{t.addEventListener(e,s)}))}function t(e,t,s){document.querySelectorAll(t).forEach((t=>{t.removeEventListener(e,s)}))}function s(e){return Object.hasOwn(e,"mirlo")||(e.mirlo={}),e.mirlo}function o(e){const t=s(e);if(Object.hasOwn(t,"component_obj"))return t.component_obj}var r={component_obj:null,set(e,t,s){const o=typeof s;if(this.component_obj&&("string"===o||"number"===o)){this.component_obj.queryAll(`[data-component-state-binds*='${t}-']`).forEach((e=>{e.dataset.componentStateBinds.split(" ").forEach((o=>{const r=o.split("-");r[0]===t&&(1===r.length?e.textContent=s:"html"===r[1]?e.innerHTML=s:e.setAttribute(r[1],s))}))}))}return Reflect.set(...arguments)}};class i{useServices=[];fetchData={};data={};#e=null;#t=[];#s={};state=null;constructor(e,t,s){-1===this.useServices.indexOf("requests")&&this.useServices.push("requests"),this.options=s||{},this.setParent(e),this.setElement(t);const o=Object.assign({},r,{component_obj:this});this.state=new Proxy(this.#s,o)}onWillStart(){const e=[];for(const t in this.fetchData)e.push(this.requests.postJSON(this.fetchData[t].endpoint,this.fetchData[t].data).then((e=>(this.data[t]=e,e))));return Promise.all(e)}onStart(){for(const e in this.events){const[t,...s]=e.split(" "),o=s&&s.join(" ")||null;(o&&this.query(o)||this.dom_el).addEventListener(t,this.events[e].bind(this))}}remove(){this.dom_el.remove()}destroy(){this.#t=[];for(const e in this.events){const[t,...s]=e.split(" "),o=s&&s.join(" ")||null;(o&&this.query(o)||this.dom_el).removeEventListener(t,this.events[e].bind(this))}}setParent(e){this.#e=e,this.#e&&this.#e.addChildren(this)}getParent(){return this.#e}addChildren(e){this.#t.push(e)}removeChildren(e){this.#t=this.#t.filter((t=>t!==e))}setElement(e){this.dom_el=e}queryAll(e){return this.dom_el.querySelectorAll(e)}query(e){return this.dom_el.querySelector(e)}}const n=new class extends i{#o={components:{},services:{}};#r={};#i=null;constructor(e,t,s,o){super(e,t,s),this.__data=o}destroy(){super.destroy();const e=Object.values(this.#r);for(const t of e)t.destroy();this.#r=[],this.#i.disconnect(),t("click","[class~='dropdown']"),t("click","[data-dismiss]")}registerComponent(e,t){Object.hasOwn(this.#o.components,e)?console.warn(`Already exists a component called '${e}'!`):this.#o.components[e]=t}getComponentClass(e){return this.#o.components[e]}invokeComponent(e,...t){const s=this.getComponentClass(e);if(s){const e=new s(this,...t);this.#n(e),e.onWillStart().then((()=>{e.onStart()}))}else console.warn(`The component '${e}' don't exists!`)}registerService(e,t,s=!1){!Object.hasOwn(this.#o.services,e)||s?this.#o.services[e]=t:console.warn(`Already exists a service called '${e}'!`)}getServiceClass(e){return this.#o.services[e]}getService(e){return this.#r[e]}getComponentById(e){const t=this.query(`#${e}`);if(t)return o(t)}onWillStart(){return super.onWillStart().then((()=>this.#a())).then((()=>this.#c()))}onStart(){super.onStart(),this.#i=new MutationObserver(this.#l.bind(this)),this.#i.observe(document.body,{childList:!0,subtree:!0}),e("click","[class~='dropdown']",this.#h.bind(this)),e("click","[data-dismiss]",this.#d.bind(this))}#a(){for(const e in this.#o.services)this.#r[e]=new this.#o.services[e];const e=[],t=Object.keys(this.#r);for(const s of t){const t=this.#r[s];e.push(t.onWillStart())}return Promise.all(e)}#c(){const e=[],t=this.queryAll("[data-component]");for(const r of t){if(o(r))continue;const t=r.dataset.component,i=this.getComponentClass(t),n=r.closest("[data-component]"),a=n&&o(n),c={};if(Object.keys(r.dataset).forEach((e=>{if(e.startsWith("componentOption")){const t=e.replace(/^componentOption/,"").toLowerCase();c[t]=r.dataset[e]}})),i){const t=new i(a||this,r,c);this.#n(t);const o=s(r);Object.assign(o,{component_obj:t}),e.push(t.onWillStart().then((()=>t.onStart())))}else console.warn(`Can't found the '${t}' component!`,r)}return Promise.all(e)}#n(e){for(const t of e.useServices)e[t]=this.#r[t]}#l(e){let t=!1;const s=function(e){for(const t of e.childNodes)s(t);const t=o(e);t&&t.destroy()};e.forEach((e=>{if("childList"===e.type){e.addedNodes.length&&(t=!0);for(const t of e.removedNodes)s(t)}})),t&&this.#c()}#h(e){this.query(e.currentTarget.dataset.target).classList.toggle("hidden")}#d(e){const t=`.${e.currentTarget.datatset.dismiss}`;e.currentTarget.closest(t).remove()}}(null,document.body);class a{onWillStart(){return Promise.resolve()}destroy(){throw Error("Not Implemented!")}}class c extends a{storage=null;getItem(e){return this.storage&&JSON.parse(this.storage.getItem(e))||void 0}setItem(e,t,s){try{return this.storage.setItem(e,JSON.stringify(t))}catch(o){if(console.error(`[StorageService] Can't set the item '${e}' = '${t}'`),s){this.#u(o)&&s(o)}}return!1}removeItem(e){return this.storage&&this.storage.removeItem(e)||void 0}#u(e){return"QuotaExceededError"===e.name}}class l extends c{storage=localStorage}class h extends c{storage=sessionStorage}class d extends a{MESSAGES={e200:"200: Invalid server result!"};getHeaders(e){return e}async postJSON(e,t){const s=(await fetch(e,{method:"POST",mode:"same-origin",cache:"no-cache",credentials:"same-origin",headers:this.getHeaders({"Content-Type":"application/json"}),redirect:"follow",referrerPolicy:"same-origin",body:JSON.stringify(t)})).json();if(this.checkServerResult(s))return s;throw Error(this.MESSAGES.e200)}async post(e,t,s="default"){let o=!1;if("object"==typeof t){o=new URLSearchParams;for(const e in t)o.append(e,t[e])}else"string"==typeof t&&(o=t);const r=(await fetch(e,{method:"POST",mode:"same-origin",cache:s,credentials:"same-origin",headers:this.getHeaders({"Content-Type":"application/x-www-form-urlencoded"}),redirect:"follow",referrerPolicy:"same-origin",body:o})).json();if(this.checkServerResult(r))return r;throw Error(this.MESSAGES.e200)}async get(e,t="default"){return(await fetch(e,{method:"GET",mode:"same-origin",cache:t,credentials:"same-origin",headers:this.getHeaders(),redirect:"follow",referrerPolicy:"same-origin"})).blob()}checkServerResult(e){if(!e||void 0===e)return!0}}function u(e,t){Object.keys(t).forEach((s=>{e.setAttribute(s,t[s])}))}class m extends i{LAZY_ELEMENT_CLASS="lazy";getNormalizedAttributes(e,t=!1){const s={};return Object.keys(e.dataset).forEach((o=>{if(o.startsWith("lazy")){const r=o.replace(/^lazy/,"").toLowerCase(),i=e.getAttribute(r),n=e.dataset[o];i&&i===n||(s[r]=n,t&&e.removeAttribute(o))}})),s}applyLazyAttributes(e){e.removeClass(this.LAZY_ELEMENT_CLASS);const t=this.getNormalizedAttributes(e,!0);if(e?.dataset.createTag){const s=document.createElement(e.dataset.createTag);u(s,t),e.replaceWith(s)}else u(e,t)}getLazyElements(){return this.queryAll(`.${this.LAZY_ELEMENT_CLASS}`)}}class p extends m{events={[`click .${this.LAZY_ELEMENT_CLASS}`]:this.#m};#m(e){this.applyLazyAttributes(e.currentTarget)}}class f extends m{events={scroll:this.#p};constructor(){super(...arguments),Object.assign(this.options,{bounce_time_scroll:75,zone_y_offset:150,zone_x_offset:75},this.options),this.load=function(e,t=300){let s=null;return(...o)=>{clearTimeout(s),s=setTimeout((()=>{e.apply(this,o)}),t)}}(this.#f.bind(this),this.options.bounce_time_scroll)}onStart(){super.onStart(),this.#f()}#f(){this.getLazyElements().forEach((e=>{this.#g(e)&&this.applyLazyAttributes(e)}))}#y(e){const t=e.offset(),s=t.left,o=t.top;return[s,o,s+e.width(),o+e.height()]}#g(e){let[t,s,o,r]=this.#y(this.dom_el);t-=this.options.zone_x_offset,s-=this.options.zone_y_offset,o+=this.options.zone_x_offset,r+=this.options.zone_y_offset;const[i,n,a,c]=this.#y(e);return i<=o&&n<=r&&a>=t&&c>=s}#p(){this.load()}}n.registerService("requests",d),n.registerService("localStorage",l),n.registerService("sessionStorage",h),n.registerComponent("lazyClick",p),n.registerComponent("lazyScroll",f),window.addEventListener("load",(()=>{n.onWillStart().then((()=>{n.onStart()}))}));export{i as Component,p as LazyClickComponent,f as LazyScrollComponent,l as LocalStorageService,d as RequestsService,a as Service,h as SessionStorageService,n as default};
